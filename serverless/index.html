<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>shout</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.3.0/css/foundation.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.min.css" />
    <style type="text/css">
        /* Turn off transitions that otherwise would fire on every step and be quite CPU hungry */ 
        button {
            transition: unset !important;
            webkit-transition: unset !important;
        }
    </style>
</head>
<body>
    <div id="main"></div>
    <!-- TODO MRB: is there a way of getting elm to smush my JS into the build? -->
    <script type="text/javascript" src="src/audio.js"></script>
    <script type="text/javascript" src="src/rtc.js"></script>
    <script type="text/javascript" src="target/shout.js"></script>
    <script type="text/javascript">
        const node = document.getElementById('main');
        const startData = localStorage.data ? localStorage.data : null;

        const app = Elm.Main.embed(node, startData);
        const audio = ShoutAudio(null); //app.ports.step.send);

        app.ports.save.subscribe((data) => {
            localStorage.data = data;
        });

        app.ports.download.subscribe((track) => {
            audio.downloadSample(track).then(app.ports.downloaded.send);
        });

        // app.ports.playbackJs.subscribe((playing) => {
        //     if(playing) {
        //         audio.start();
        //     } else {
        //         audio.stop();
        //     }
        // });

        // app.ports.generateToken.subscribe(() => {
        //     ShoutRtc.generateToken().then((token) => {
        //         console.log(token);  
        //     });
        // });
    </script>
</body>
</html>